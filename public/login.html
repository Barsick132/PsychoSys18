<!DOCTYPE html>
<html lang="ru">

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>Вход в систему</title>
  <!-- Bootstrap core CSS -->
  <link href="css/bootstrap.min.css" rel="stylesheet">
  <!-- Custom styles for this template -->
  <link href="css/signin.css" rel="stylesheet">    
  <style type="text/css">
    body:after {
        content: "";
        display: block;
        position: absolute;
        top: 0;
        left: 0;
        /*background-image: url(bgimg_1.png);*/
        width: 100%;
        height: 100%;
        opacity: 0.4;
        z-index: -1;
    }
</style>
</head>

<body class="text-center">
  <form class="form-signin" id="app">
    <h1 class="h3 mb-3 font-weight-normal">Система психологического сопровождения</h1>
    <label for="inputLogin" class="sr-only">Логин</label>
    <input type="text" id="inputLogin" v-model="login" class="form-control" placeholder="Логин" required>
    <label for="inputPassword" class="sr-only">Пароль</label>
    <input type="password" id="inputPassword" v-model="password" class="form-control mt-2" placeholder="Пароль" minlength="6" required>
    <button class="btn btn-lg btn-primary btn-block" v-on:click="sendData">Вход</button>
    <a class="mt-1 mb-3 btn btn-link" href="/reg_parent.html" role="button">Регистрация (для родителей)</a>
  </form>
  
  <script src="js/app.js"></script>
  <script src="js/vue.js"></script>
  <script>
    var app = new Vue({
      el: '#app',
      data: {
        login: 'Admin',//'Student',//
        password: 'P@ssword',//'123kT@',//
        rememberMe: true,
      },

      methods: {
        // Подсветка выбора кнопки
        checkInput: function (target) {
          obj = target.target;
          if (obj.value == "" || obj.value.length < obj.minLength) {
            obj.classList.remove("is-valid");
            obj.classList.add("is-invalid");
          } else {
            obj.classList.remove("is-invalid");
            obj.classList.add("is-valid");
          }
        },

        sendData: function () {
          window.event.preventDefault();
          if (this.login == '') {
            alert("Введите логин!");
            return;
          }

          if (this.password == '') {
            alert("Введите пароль!");
            return;
          }
          this.authCheck("Basic " + window.btoa(unescape(encodeURIComponent(this.login + ':' + this.password))), this.rememberMe);
        },

        // Авторизация
        authCheck: function (token, remember) {
          login(token).then(
            function (data) {
              console.log(data);
              if (data.status != "OK") {return;}
                if (remember) {
                  localStorage.setItem('token', data.payload.token);
                } else {
                  localStorage.removeItem('token');
                }
                var url = "";
                if(data.payload.role_array.indexOf('Admin') >= 0){
                  url = "/lk_admin.html";
                } else if (data.payload.role_array.indexOf('Psychologist') >= 0) {
                  url = "/lk_psycho.html";
                } else if (data.payload.role_array.indexOf('Teacher') >= 0) {
                  url = "/lk_teacher.html";
                } else if (data.payload.role_array.indexOf('Parent') >= 0) {
                  url = "/lk_parent.html";
                } else if (data.payload.role_array.indexOf('Student') >= 0) {
                  url = "/lk_learner.html";
                } else if (data.payload.role_array.findindexOf('Employee') >= 0) {
                  url = "/lk_employee.html";
                }
                // переадресация
                document.location.replace(url);
              },
              function(err) {
                console.error(err);
                //alert(`Fulfilled: ${err}`)
              }
          )
        },
      },
      mounted: function () {
        var tok = localStorage.getItem('token');
        if (tok != "" && tok != null)
          this.authCheck(tok, true);
      }
    });
  </script>
</body>

</html>